!function($,e,t,s){"use strict";$.fn.search=function(n){var r=$(this),i=r.selector||"",a=(new Date).getTime(),c=[],o=arguments[0],u="string"==typeof o,l=[].slice.call(arguments,1),d;return $(this).each(function(){var g=$.isPlainObject(n)?$.extend(!0,{},$.fn.search.settings,n):$.extend({},$.fn.search.settings),f=g.className,p=g.metadata,v=g.regExp,h=g.fields,m=g.selector,b=g.error,y=g.namespace,R="."+y,C=y+"-module",w=$(this),x=w.find(m.prompt),j=w.find(m.searchButton),k=w.find(m.results),q=w.find(m.result),E=w.find(m.category),A=this,T=w.data(C),F;F={initialize:function(){F.verbose("Initializing module"),F.determine.searchFields(),F.bind.events(),F.set.type(),F.create.results(),F.instantiate()},instantiate:function(){F.verbose("Storing instance of module",F),T=F,w.data(C,F)},destroy:function(){F.verbose("Destroying instance"),w.off(R).removeData(C)},bind:{events:function(){F.verbose("Binding events to search"),g.automatic&&(w.on(F.get.inputEvent()+R,m.prompt,F.event.input),x.attr("autocomplete","off")),w.on("focus"+R,m.prompt,F.event.focus).on("blur"+R,m.prompt,F.event.blur).on("keydown"+R,m.prompt,F.handleKeyboard).on("click"+R,m.searchButton,F.query).on("mousedown"+R,m.results,F.event.result.mousedown).on("mouseup"+R,m.results,F.event.result.mouseup).on("click"+R,m.result,F.event.result.click)}},determine:{searchFields:function(){n&&n.searchFields!==s&&(g.searchFields=n.searchFields)}},event:{input:function(){clearTimeout(F.timer),F.timer=setTimeout(F.query,g.searchDelay)},focus:function(){F.set.focus(),F.has.minimumCharacters()&&(F.query(),F.can.show()&&F.showResults())},blur:function(e){var s=t.activeElement===this,n=function(){F.cancel.query(),F.remove.focus(),F.timer=setTimeout(F.hideResults,g.hideDelay)};s||(F.resultsClicked?(F.debug("Determining if user action caused search to close"),w.one("click",m.results,function(e){F.is.animating()||F.is.hidden()||n()})):(F.debug("Input blurred without user action, closing results"),n()))},result:{mousedown:function(){F.resultsClicked=!0},mouseup:function(){F.resultsClicked=!1},click:function(t){F.debug("Search result selected");var s=$(this),n=s.find(m.title).eq(0),r=s.find("a[href]").eq(0),i=r.attr("href")||!1,a=r.attr("target")||!1,c=n.html(),o=n.length>0?n.text():!1,u=F.get.results(),l=s.data(p.result)||F.get.result(o,u),d;return $.isFunction(g.onSelect)&&g.onSelect.call(A,l,u)===!1?void F.debug("Custom onSelect callback cancelled default select action"):(F.hideResults(),o&&F.set.value(o),void(i&&(F.verbose("Opening search link found in result",r),"_blank"==a||t.ctrlKey?e.open(i):e.location.href=i)))}}},handleKeyboard:function(e){var t=w.find(m.result),s=w.find(m.category),n=t.index(t.filter("."+f.active)),r=t.length,i=e.which,a={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},c;if(i==a.escape&&(F.verbose("Escape key pressed, blurring search field"),F.trigger.blur()),F.is.visible())if(i==a.enter){if(F.verbose("Enter key pressed, selecting active result"),t.filter("."+f.active).length>0)return F.event.result.click.call(t.filter("."+f.active),e),e.preventDefault(),!1}else i==a.upArrow?(F.verbose("Up key pressed, changing active result"),c=0>n-1?n:n-1,s.removeClass(f.active),t.removeClass(f.active).eq(c).addClass(f.active).closest(s).addClass(f.active),e.preventDefault()):i==a.downArrow&&(F.verbose("Down key pressed, changing active result"),c=n+1>=r?n:n+1,s.removeClass(f.active),t.removeClass(f.active).eq(c).addClass(f.active).closest(s).addClass(f.active),e.preventDefault());else i==a.enter&&(F.verbose("Enter key pressed, executing query"),F.query(),F.set.buttonPressed(),x.one("keyup",F.remove.buttonFocus))},setup:{api:function(){var e={debug:g.debug,on:!1,cache:"local",action:"search",onError:F.error},t;F.verbose("First request, initializing API"),w.api(e)}},can:{useAPI:function(){return $.fn.api!==s},show:function(){return F.is.focused()&&!F.is.visible()&&!F.is.empty()},transition:function(){return g.transition&&$.fn.transition!==s&&w.transition("is supported")}},is:{animating:function(){return k.hasClass(f.animating)},hidden:function(){return k.hasClass(f.hidden)},empty:function(){return""===k.html()},visible:function(){return k.filter(":visible").length>0},focused:function(){return x.filter(":focus").length>0}},trigger:{blur:function(){var e=t.createEvent("HTMLEvents"),s=x[0];s&&(F.verbose("Triggering native blur event"),e.initEvent("blur",!1,!1),s.dispatchEvent(e))}},get:{inputEvent:function(){var e=x[0],t=e!==s&&e.oninput!==s?"input":e!==s&&e.onpropertychange!==s?"propertychange":"keyup";return t},value:function(){return x.val()},results:function(){var e=w.data(p.results);return e},result:function(e,t){var n=["title","id"],r=!1;return e=e!==s?e:F.get.value(),t=t!==s?t:F.get.results(),"category"===g.type?(F.debug("Finding result that matches",e),$.each(t,function(t,s){return $.isArray(s.results)&&(r=F.search.object(e,s.results,n)[0])?!1:void 0})):(F.debug("Finding result in results object",e),r=F.search.object(e,t,n)[0]),r||!1}},set:{focus:function(){w.addClass(f.focus)},loading:function(){w.addClass(f.loading)},value:function(e){F.verbose("Setting search input value",e),x.val(e)},type:function(e){e=e||g.type,"category"==g.type&&w.addClass(g.type)},buttonPressed:function(){j.addClass(f.pressed)}},remove:{loading:function(){w.removeClass(f.loading)},focus:function(){w.removeClass(f.focus)},buttonPressed:function(){j.removeClass(f.pressed)}},query:function(){var e=F.get.value(),t=F.read.cache(e);F.has.minimumCharacters()?(t?(F.debug("Reading result from cache",e),F.save.results(t.results),F.addResults(t.html),F.inject.id(t.results)):(F.debug("Querying for",e),$.isPlainObject(g.source)||$.isArray(g.source)?F.search.local(e):F.can.useAPI()?F.search.remote(e):F.error(b.source)),g.onSearchQuery.call(A,e)):F.hideResults()},search:{local:function(e){var t=F.search.object(e,g.content),s;F.set.loading(),F.save.results(t),F.debug("Returned local search results",t),s=F.generateResults({results:t}),F.remove.loading(),F.addResults(s),F.inject.id(t),F.write.cache(e,{html:s,results:t})},remote:function(e){var t={onSuccess:function(t){F.parse.response.call(A,t,e)},onFailure:function(){F.displayMessage(b.serverError)},urlData:{query:e}};w.api("get request")||F.setup.api(),$.extend(!0,t,g.apiSettings),F.debug("Executing search",t),F.cancel.query(),w.api("setting",t).api("query")},object:function(e,t,n){var r=[],i=[],a=e.toString().replace(v.escape,"\\$&"),c=new RegExp(v.beginsWith+a,"i"),o=function(e,t){var s=-1==$.inArray(t,r),n=-1==$.inArray(t,i);s&&n&&e.push(t)};return t=t||g.source,n=n!==s?n:g.searchFields,$.isArray(n)||(n=[n]),t===s||t===!1?(F.error(b.source),[]):($.each(n,function(s,n){$.each(t,function(t,s){var a="string"==typeof s[n];a&&(-1!==s[n].search(c)?o(r,s):g.searchFullText&&F.fuzzySearch(e,s[n])&&o(i,s))})}),$.merge(r,i))}},fuzzySearch:function(e,t){var s=t.length,n=e.length;if("string"!=typeof e)return!1;if(e=e.toLowerCase(),t=t.toLowerCase(),n>s)return!1;if(n===s)return e===t;e:for(var r=0,i=0;n>r;r++){for(var a=e.charCodeAt(r);s>i;)if(t.charCodeAt(i++)===a)continue e;return!1}return!0},parse:{response:function(e,t){var n=F.generateResults(e);F.verbose("Parsing server response",e),e!==s&&t!==s&&e[h.results]!==s&&(F.addResults(n),F.inject.id(e[h.results]),F.write.cache(t,{html:n,results:e[h.results]}),F.save.results(e[h.results]))}},cancel:{query:function(){F.can.useAPI()&&w.api("abort")}},has:{minimumCharacters:function(){var e=F.get.value(),t=e.length;return t>=g.minCharacters}},clear:{cache:function(e){var t=w.data(p.cache);e?e&&t&&t[e]&&(F.debug("Removing value from cache",e),delete t[e],w.data(p.cache,t)):(F.debug("Clearing cache",e),w.removeData(p.cache))}},read:{cache:function(e){var t=w.data(p.cache);return g.cache?(F.verbose("Checking cache for generated html for query",e),"object"==typeof t&&t[e]!==s?t[e]:!1):!1}},create:{id:function(e,t){var n=e+1,r=t+1,i,a,c;return t!==s?(a=String.fromCharCode(97+t),c=a+n,F.verbose("Creating category result id",c)):(c=n,F.verbose("Creating result id",c)),c},results:function(){0===k.length&&(k=$("<div />").addClass(f.results).appendTo(w))}},inject:{result:function(e,t,n){F.verbose("Injecting result into results");var r=n!==s?k.children().eq(n).children(m.result).eq(t):k.children(m.result).eq(t);F.verbose("Injecting results metadata",r),r.data(p.result,e)},id:function(e){F.debug("Injecting unique ids into results");var t=0,n=0;return"category"===g.type?$.each(e,function(e,r){n=0,$.each(r.results,function(e,i){var a=r.results[e];a.id===s&&(a.id=F.create.id(n,t)),F.inject.result(a,n,t),n++}),t++}):$.each(e,function(t,r){var i=e[t];i.id===s&&(i.id=F.create.id(n)),F.inject.result(i,n),n++}),e}},save:{results:function(e){F.verbose("Saving current search results to metadata",e),w.data(p.results,e)}},write:{cache:function(e,t){var n=w.data(p.cache)!==s?w.data(p.cache):{};g.cache&&(F.verbose("Writing generated html to cache",e,t),n[e]=t,w.data(p.cache,n))}},addResults:function(e){return $.isFunction(g.onResultsAdd)&&g.onResultsAdd.call(k,e)===!1?(F.debug("onResultsAdd callback cancelled default action"),!1):(k.html(e),void(F.can.show()&&F.showResults()))},showResults:function(){F.is.visible()||(F.can.transition()?(F.debug("Showing results with css animations"),k.transition({animation:g.transition+" in",debug:g.debug,verbose:g.verbose,duration:g.duration,queue:!0})):(F.debug("Showing results with javascript"),k.stop().fadeIn(g.duration,g.easing)),g.onResultsOpen.call(k))},hideResults:function(){F.is.visible()&&(F.can.transition()?(F.debug("Hiding results with css animations"),k.transition({animation:g.transition+" out",debug:g.debug,verbose:g.verbose,duration:g.duration,queue:!0})):(F.debug("Hiding results with javascript"),k.stop().fadeOut(g.duration,g.easing)),g.onResultsClose.call(k))},generateResults:function(e){F.debug("Generating html from response",e);var t=g.templates[g.type],s=$.isPlainObject(e[h.results])&&!$.isEmptyObject(e[h.results]),n=$.isArray(e[h.results])&&e[h.results].length>0,r="";return s||n?(g.maxResults>0&&(s?"standard"==g.type&&F.error(b.maxResults):e[h.results]=e[h.results].slice(0,g.maxResults)),$.isFunction(t)?r=t(e,h):F.error(b.noTemplate,!1)):r=F.displayMessage(b.noResults,"empty"),g.onResults.call(A,e),r},displayMessage:function(e,t){return t=t||"standard",F.debug("Displaying message",e,t),F.addResults(g.templates.message(e,t)),g.templates.message(e,t)},setting:function(e,t){if($.isPlainObject(e))$.extend(!0,g,e);else{if(t===s)return g[e];g[e]=t}},internal:function(e,t){if($.isPlainObject(e))$.extend(!0,F,e);else{if(t===s)return F[e];F[e]=t}},debug:function(){g.debug&&(g.performance?F.performance.log(arguments):(F.debug=Function.prototype.bind.call(console.info,console,g.name+":"),F.debug.apply(console,arguments)))},verbose:function(){g.verbose&&g.debug&&(g.performance?F.performance.log(arguments):(F.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),F.verbose.apply(console,arguments)))},error:function(){F.error=Function.prototype.bind.call(console.error,console,g.name+":"),F.error.apply(console,arguments)},performance:{log:function(e){var t,s,n;g.performance&&(t=(new Date).getTime(),n=a||t,s=t-n,a=t,c.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:A,"Execution Time":s})),clearTimeout(F.performance.timer),F.performance.timer=setTimeout(F.performance.display,500)},display:function(){var e=g.name+":",t=0;a=!1,clearTimeout(F.performance.timer),$.each(c,function(e,s){t+=s["Execution Time"]}),e+=" "+t+"ms",i&&(e+=" '"+i+"'"),r.length>1&&(e+=" ("+r.length+")"),(console.group!==s||console.table!==s)&&c.length>0&&(console.groupCollapsed(e),console.table?console.table(c):$.each(c,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),c=[]}},invoke:function(e,t,n){var r=T,i,a,c;return t=t||l,n=A||n,"string"==typeof e&&r!==s&&(e=e.split(/[\. ]/),i=e.length-1,$.each(e,function(t,n){var c=t!=i?n+e[t+1].charAt(0).toUpperCase()+e[t+1].slice(1):e;if($.isPlainObject(r[c])&&t!=i)r=r[c];else{if(r[c]!==s)return a=r[c],!1;if(!$.isPlainObject(r[n])||t==i)return r[n]!==s?(a=r[n],!1):!1;r=r[n]}})),$.isFunction(a)?c=a.apply(n,t):a!==s&&(c=a),$.isArray(d)?d.push(c):d!==s?d=[d,c]:c!==s&&(d=c),a}},u?(T===s&&F.initialize(),F.invoke(o)):(T!==s&&T.invoke("destroy"),F.initialize())}),d!==s?d:this},$.fn.search.settings={name:"Search",namespace:"search",debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,apiSettings:!1,source:!1,searchFields:["title","description"],displayField:"",searchFullText:!0,automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(e){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result",title:".title, .name"},templates:{escape:function(e){var t=/[&<>"'`]/g,s=/[&<>"'`]/,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},r=function(e){return n[e]};return s.test(e)?e.replace(t,r):e},message:function(e,t){var n="";return e!==s&&t!==s&&(n+='<div class="message '+t+'">',n+="empty"==t?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>",n+="</div>"),n},category:function(e,t){var n="",r=$.fn.search.settings.templates.escape;return e[t.categoryResults]!==s?($.each(e[t.categoryResults],function(e,r){r[t.results]!==s&&r.results.length>0&&(n+='<div class="category">',r[t.categoryName]!==s&&(n+='<div class="name">'+r[t.categoryName]+"</div>"),$.each(r.results,function(e,r){n+=r[t.url]?'<a class="result" href="'+r[t.url]+'">':'<a class="result">',r[t.image]!==s&&(n+='<div class="image"> <img src="'+r[t.image]+'"></div>'),n+='<div class="content">',r[t.price]!==s&&(n+='<div class="price">'+r[t.price]+"</div>"),r[t.title]!==s&&(n+='<div class="title">'+r[t.title]+"</div>"),r[t.description]!==s&&(n+='<div class="description">'+r[t.description]+"</div>"),n+="</div>",n+="</a>"}),n+="</div>")}),e[t.action]&&(n+='<a href="'+e[t.action][t.actionURL]+'" class="action">'+e[t.action][t.actionText]+"</a>"),n):!1},standard:function(e,t){var n="";return e[t.results]!==s?($.each(e[t.results],function(e,r){n+=r[t.url]?'<a class="result" href="'+r[t.url]+'">':'<a class="result">',r[t.image]!==s&&(n+='<div class="image"> <img src="'+r[t.image]+'"></div>'),n+='<div class="content">',r[t.price]!==s&&(n+='<div class="price">'+r[t.price]+"</div>"),r[t.title]!==s&&(n+='<div class="title">'+r[t.title]+"</div>"),r[t.description]!==s&&(n+='<div class="description">'+r[t.description]+"</div>"),n+="</div>",n+="</a>"}),e[t.action]&&(n+='<a href="'+e[t.action][t.actionURL]+'" class="action">'+e[t.action][t.actionText]+"</a>"),n):!1}}}}(jQuery,window,document);
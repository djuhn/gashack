!function($,e,t,a){"use strict";$.fn.tab=function(n){var i=$($.isFunction(this)?e:this),o=i.selector||"",r=(new Date).getTime(),s=[],c=arguments[0],l="string"==typeof c,d=[].slice.call(arguments,1),u=!1,b;return i.each(function(){var g=$.isPlainObject(n)?$.extend(!0,{},$.fn.tab.settings,n):$.extend({},$.fn.tab.settings),f=g.className,h=g.metadata,p=g.selector,m=g.error,v="."+g.namespace,y="module-"+g.namespace,T=$(this),L,x,A={},P=!0,C=0,F=this,S=T.data(y),E,j,k,w;k={initialize:function(){k.debug("Initializing tab menu item",T),k.fix.callbacks(),k.determineTabs(),k.debug("Determining tabs",g.context,x),g.auto&&k.set.auto(),k.bind.events(),g.history&&!u&&(k.initializeHistory(),u=!0),k.instantiate()},instantiate:function(){k.verbose("Storing instance of module",k),S=k,T.data(y,k)},destroy:function(){k.debug("Destroying tabs",T),T.removeData(y).off(v)},bind:{events:function(){$.isWindow(F)||(k.debug("Attaching tab activation events to element",T),T.on("click"+v,k.event.click))}},determineTabs:function(){var e;"parent"===g.context?(T.closest(p.ui).length>0?(e=T.closest(p.ui),k.verbose("Using closest UI element as parent",e)):e=T,L=e.parent(),k.verbose("Determined parent element for creating context",L)):g.context?(L=$(g.context),k.verbose("Using selector for tab context",g.context,L)):L=$("body"),g.childrenOnly?(x=L.children(p.tabs),k.debug("Searching tab context children for tabs",L,x)):(x=L.find(p.tabs),k.debug("Searching tab context for tabs",L,x))},fix:{callbacks:function(){$.isPlainObject(n)&&(n.onTabLoad||n.onTabInit)&&(n.onTabLoad&&(n.onLoad=n.onTabLoad,delete n.onTabLoad,k.error(m.legacyLoad,n.onLoad)),n.onTabInit&&(n.onFirstLoad=n.onTabInit,delete n.onTabInit,k.error(m.legacyInit,n.onFirstLoad)),g=$.extend(!0,{},$.fn.tab.settings,n))}},initializeHistory:function(){if(k.debug("Initializing page state"),$.address===a)return k.error(m.state),!1;if("state"==g.historyType){if(k.debug("Using HTML5 to manage state"),g.path===!1)return k.error(m.path),!1;$.address.history(!0).state(g.path)}$.address.bind("change",k.event.history.change)},event:{click:function(e){var t=$(this).data(h.tab);t!==a?(g.history?(k.verbose("Updating page state",e),$.address.value(t)):(k.verbose("Changing tab",e),k.changeTab(t)),e.preventDefault()):k.debug("No tab specified")},history:{change:function(e){var t=e.pathNames.join("/")||k.get.initialPath(),n=g.templates.determineTitle(t)||!1;k.performance.display(),k.debug("History change event",t,e),w=e,t!==a&&k.changeTab(t),n&&$.address.title(n)}}},refresh:function(){E&&(k.debug("Refreshing tab",E),k.changeTab(E))},cache:{read:function(e){return e!==a?A[e]:!1},add:function(e,t){e=e||E,k.debug("Adding cached content for",e),A[e]=t},remove:function(e){e=e||E,k.debug("Removing cached content for",e),delete A[e]}},set:{auto:function(){var e="string"==typeof g.path?g.path.replace(/\/$/,"")+"/{$tab}":"/{$tab}";k.verbose("Setting up automatic tab retrieval from server",e),$.isPlainObject(g.apiSettings)?g.apiSettings.url=e:g.apiSettings={url:e}},loading:function(e){var t=k.get.tabElement(e),a=t.hasClass(f.loading);a||(k.verbose("Setting loading state for",t),t.addClass(f.loading).siblings(x).removeClass(f.active+" "+f.loading),t.length>0&&g.onRequest.call(t[0],e))},state:function(e){$.address.value(e)}},changeTab:function(t){var a=e.history&&e.history.pushState,n=a&&g.ignoreFirstLoad&&P,i=g.auto||$.isPlainObject(g.apiSettings),o=i&&!n?k.utilities.pathToArray(t):k.get.defaultPathArray(t);t=k.utilities.arrayToPath(o),$.each(o,function(e,a){var r=o.slice(0,e+1),s=k.utilities.arrayToPath(r),c=k.is.tab(s),l=e+1==o.length,d=k.get.tabElement(s),u,b,p,v;if(k.verbose("Looking for tab",a),c){if(k.verbose("Tab was found",a),E=s,j=k.utilities.filterArray(o,r),l?v=!0:(b=o.slice(0,e+2),p=k.utilities.arrayToPath(b),v=!k.is.tab(p),v&&k.verbose("Tab parameters found",b)),v&&i)return n?(k.debug("Ignoring remote content on first tab load",s),P=!1,k.cache.add(t,d.html()),k.activate.all(s),g.onFirstLoad.call(d[0],s,j,w),g.onLoad.call(d[0],s,j,w)):(k.activate.navigation(s),k.fetch.content(s,t)),!1;k.debug("Opened local tab",s),k.activate.all(s),k.cache.read(s)||(k.cache.add(s,!0),k.debug("First time tab loaded calling tab init"),g.onFirstLoad.call(d[0],s,j,w)),g.onLoad.call(d[0],s,j,w)}else{if(-1!=t.search("/")||""===t)return k.error(m.missingTab,T,L,s),!1;if(u=$("#"+t+', a[name="'+t+'"]'),s=u.closest("[data-tab]").data(h.tab),d=k.get.tabElement(s),u&&u.length>0&&s)return k.debug("Anchor link used, opening parent tab",d,u),d.hasClass(f.active)||setTimeout(function(){k.scrollTo(u)},0),k.activate.all(s),k.cache.read(s)||(k.cache.add(s,!0),k.debug("First time tab loaded calling tab init"),g.onFirstLoad.call(d[0],s,j,w)),g.onLoad.call(d[0],s,j,w),!1}})},scrollTo:function(e){var a=e&&e.length>0?e.offset().top:!1;a!==!1&&(k.debug("Forcing scroll to an in-page link in a hidden tab",a,e),$(t).scrollTop(a))},update:{content:function(e,t,n){var i=k.get.tabElement(e),o=i[0];n=n!==a?n:g.evaluateScripts,n?(k.debug("Updating HTML and evaluating inline scripts",e,t),i.html(t)):(k.debug("Updating HTML",e,t),o.innerHTML=t)}},fetch:{content:function(e,t){var n=k.get.tabElement(e),i={dataType:"html",encodeParameters:!1,on:"now",cache:g.alwaysRefresh,headers:{"X-Remote":!0},onSuccess:function(a){k.cache.add(t,a),k.update.content(e,a),e==E?(k.debug("Content loaded",e),k.activate.tab(e)):k.debug("Content loaded in background",e),g.onFirstLoad.call(n[0],e,j,w),g.onLoad.call(n[0],e,j,w)},urlData:{tab:t}},o=n.api("get request")||!1,r=o&&"pending"===o.state(),s,c;t=t||e,c=k.cache.read(t),g.cache&&c?(k.activate.tab(e),k.debug("Adding cached content",t),"once"==g.evaluateScripts?k.update.content(e,c,!1):k.update.content(e,c),g.onLoad.call(n[0],e,j,w)):r?(k.set.loading(e),k.debug("Content is already loading",t)):$.api!==a?(s=$.extend(!0,{},g.apiSettings,i),k.debug("Retrieving remote content",t,s),k.set.loading(e),n.api(s)):k.error(m.api)}},activate:{all:function(e){k.activate.tab(e),k.activate.navigation(e)},tab:function(e){var t=k.get.tabElement(e),a=t.hasClass(f.active);k.verbose("Showing tab content for",t),a||(t.addClass(f.active).siblings(x).removeClass(f.active+" "+f.loading),t.length>0&&g.onVisible.call(t[0],e))},navigation:function(e){var t=k.get.navElement(e),a=t.hasClass(f.active);k.verbose("Activating tab navigation for",t,e),a||t.addClass(f.active).siblings(i).removeClass(f.active+" "+f.loading)}},deactivate:{all:function(){k.deactivate.navigation(),k.deactivate.tabs()},navigation:function(){i.removeClass(f.active)},tabs:function(){x.removeClass(f.active+" "+f.loading)}},is:{tab:function(e){return e!==a?k.get.tabElement(e).length>0:!1}},get:{initialPath:function(){return i.eq(0).data(h.tab)||x.eq(0).data(h.tab)},path:function(){return $.address.value()},defaultPathArray:function(e){return k.utilities.pathToArray(k.get.defaultPath(e))},defaultPath:function(e){var t=i.filter("[data-"+h.tab+'^="'+e+'/"]').eq(0),a=t.data(h.tab)||!1;if(a){if(k.debug("Found default tab",a),C<g.maxDepth)return C++,k.get.defaultPath(a);k.error(m.recursion)}else k.debug("No default tabs found for",e,x);return C=0,e},navElement:function(e){return e=e||E,i.filter("[data-"+h.tab+'="'+e+'"]')},tabElement:function(e){var t,a,n,i;return e=e||E,n=k.utilities.pathToArray(e),i=k.utilities.last(n),t=x.filter("[data-"+h.tab+'="'+e+'"]'),a=x.filter("[data-"+h.tab+'="'+i+'"]'),t.length>0?t:a},tab:function(){return E}},utilities:{filterArray:function(e,t){return $.grep(e,function(e){return-1==$.inArray(e,t)})},last:function(e){return $.isArray(e)?e[e.length-1]:!1},pathToArray:function(e){return e===a&&(e=E),"string"==typeof e?e.split("/"):[e]},arrayToPath:function(e){return $.isArray(e)?e.join("/"):!1}},setting:function(e,t){if(k.debug("Changing setting",e,t),$.isPlainObject(e))$.extend(!0,g,e);else{if(t===a)return g[e];g[e]=t}},internal:function(e,t){if($.isPlainObject(e))$.extend(!0,k,e);else{if(t===a)return k[e];k[e]=t}},debug:function(){g.debug&&(g.performance?k.performance.log(arguments):(k.debug=Function.prototype.bind.call(console.info,console,g.name+":"),k.debug.apply(console,arguments)))},verbose:function(){g.verbose&&g.debug&&(g.performance?k.performance.log(arguments):(k.verbose=Function.prototype.bind.call(console.info,console,g.name+":"),k.verbose.apply(console,arguments)))},error:function(){k.error=Function.prototype.bind.call(console.error,console,g.name+":"),k.error.apply(console,arguments)},performance:{log:function(e){var t,a,n;g.performance&&(t=(new Date).getTime(),n=r||t,a=t-n,r=t,s.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:F,"Execution Time":a})),clearTimeout(k.performance.timer),k.performance.timer=setTimeout(k.performance.display,500)},display:function(){var e=g.name+":",t=0;r=!1,clearTimeout(k.performance.timer),$.each(s,function(e,a){t+=a["Execution Time"]}),e+=" "+t+"ms",o&&(e+=" '"+o+"'"),(console.group!==a||console.table!==a)&&s.length>0&&(console.groupCollapsed(e),console.table?console.table(s):$.each(s,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),s=[]}},invoke:function(e,t,n){var i=S,o,r,s;return t=t||d,n=F||n,"string"==typeof e&&i!==a&&(e=e.split(/[\. ]/),o=e.length-1,$.each(e,function(t,n){var s=t!=o?n+e[t+1].charAt(0).toUpperCase()+e[t+1].slice(1):e;if($.isPlainObject(i[s])&&t!=o)i=i[s];else{if(i[s]!==a)return r=i[s],!1;if(!$.isPlainObject(i[n])||t==o)return i[n]!==a?(r=i[n],!1):(k.error(m.method,e),!1);i=i[n]}})),$.isFunction(r)?s=r.apply(n,t):r!==a&&(s=r),$.isArray(b)?b.push(s):b!==a?b=[b,s]:s!==a&&(b=s),r}},l?(S===a&&k.initialize(),k.invoke(c)):(S!==a&&S.invoke("destroy"),k.initialize())}),b!==a?b:this},$.tab=function(){$(e).tab.apply(this,arguments)},$.fn.tab.settings={name:"Tab",namespace:"tab",debug:!1,verbose:!1,performance:!0,auto:!1,history:!1,historyType:"hash",path:!1,context:!1,childrenOnly:!1,maxDepth:25,alwaysRefresh:!1,cache:!0,ignoreFirstLoad:!1,apiSettings:!1,evaluateScripts:"once",onFirstLoad:function(e,t,a){},onLoad:function(e,t,a){},onVisible:function(e,t,a){},onRequest:function(e,t,a){},templates:{determineTitle:function(e){}},error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Activated tab cannot be found. Tabs are case-sensitive.",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",legacyInit:"onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.",legacyLoad:"onTabLoad has been renamed to onLoad in 2.0. Please adjust your code",state:"History requires Asual's Address library <https://github.com/asual/jquery-address>"},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab",ui:".ui"}}}(jQuery,window,document);
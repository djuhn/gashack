!function($,e,o,n){"use strict";$.fn.visibility=function(t){var i=$(this),s=i.selector||"",c=(new Date).getTime(),r=[],a=arguments[0],l="string"==typeof a,d=[].slice.call(arguments,1),u;return i.each(function(){var i=$.isPlainObject(t)?$.extend(!0,{},$.fn.visibility.settings,t):$.extend({},$.fn.visibility.settings),f=i.className,b=i.namespace,m=i.error,g=i.metadata,p="."+b,v="module-"+b,h=$(e),P=$(this),x=$(i.context),C,y=P.selector||"",R=P.data(v),V=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,0)},S=this,k=!1,T,O;O={initialize:function(){O.debug("Initializing",i),O.setup.cache(),O.should.trackChanges()&&("image"==i.type&&O.setup.image(),"fixed"==i.type&&O.setup.fixed(),i.observeChanges&&O.observeChanges(),O.bind.events()),O.save.position(),O.is.visible()||O.error(m.visible,P),i.initialCheck&&O.checkVisibility(),O.instantiate()},instantiate:function(){O.debug("Storing instance",O),P.data(v,O),R=O},destroy:function(){O.verbose("Destroying previous module"),T&&T.disconnect(),h.off("load"+p,O.event.load).off("resize"+p,O.event.resize),x.off("scrollchange"+p,O.event.scrollchange),P.off(p).removeData(v)},observeChanges:function(){"MutationObserver"in e&&(T=new MutationObserver(function(e){O.verbose("DOM tree modified, updating visibility calculations"),O.timer=setTimeout(function(){O.verbose("DOM tree modified, updating sticky menu"),O.refresh()},100)}),T.observe(S,{childList:!0,subtree:!0}),O.debug("Setting up mutation observer",T))},bind:{events:function(){O.verbose("Binding visibility events to scroll and resize"),i.refreshOnLoad&&h.on("load"+p,O.event.load),h.on("resize"+p,O.event.resize),x.off("scroll"+p).on("scroll"+p,O.event.scroll).on("scrollchange"+p,O.event.scrollchange)}},event:{resize:function(){O.debug("Window resized"),i.refreshOnResize&&V(O.refresh)},load:function(){O.debug("Page finished loading"),V(O.refresh)},scroll:function(){i.throttle?(clearTimeout(O.timer),O.timer=setTimeout(function(){x.triggerHandler("scrollchange"+p,[x.scrollTop()])},i.throttle)):V(function(){x.triggerHandler("scrollchange"+p,[x.scrollTop()])})},scrollchange:function(e,o){O.checkVisibility(o)}},precache:function(e,n){e instanceof Array||(e=[e]);for(var t=e.length,i=0,s=[],c=o.createElement("img"),r=function(){i++,i>=e.length&&$.isFunction(n)&&n()};t--;)c=o.createElement("img"),c.onload=r,c.onerror=r,c.src=e[t],s.push(c)},enableCallbacks:function(){O.debug("Allowing callbacks to occur"),k=!1},disableCallbacks:function(){O.debug("Disabling all callbacks temporarily"),k=!0},should:{trackChanges:function(){return l?(O.debug("One time query, no need to bind events"),!1):(O.debug("Callbacks being attached"),!0)}},setup:{cache:function(){O.cache={occurred:{},screen:{},element:{}}},image:function(){var e=P.data(g.src);e&&(O.verbose("Lazy loading image",e),i.once=!0,i.observeChanges=!1,i.onOnScreen=function(){O.debug("Image on screen",S),O.precache(e,function(){O.set.image(e)})})},fixed:function(){O.debug("Setting up fixed"),i.once=!1,i.observeChanges=!1,i.initialCheck=!0,i.refreshOnLoad=!0,t.transition||(i.transition=!1),O.create.placeholder(),O.debug("Added placeholder",C),i.onTopPassed=function(){O.debug("Element passed, adding fixed position",P),O.show.placeholder(),O.set.fixed(),i.transition&&$.fn.transition!==n&&P.transition(i.transition,i.duration)},i.onTopPassedReverse=function(){O.debug("Element returned to position, removing fixed",P),O.hide.placeholder(),O.remove.fixed()}}},create:{placeholder:function(){O.verbose("Creating fixed position placeholder"),C=P.clone(!1).css("display","none").addClass(f.placeholder).insertAfter(P)}},show:{placeholder:function(){O.verbose("Showing placeholder"),C.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){O.verbose("Hiding placeholder"),C.css("display","none").css("visibility","")}},set:{fixed:function(){O.verbose("Setting element to fixed position"),P.addClass(f.fixed).css({position:"fixed",top:i.offset+"px",left:"auto",zIndex:"1"})},image:function(e){P.attr("src",e),i.transition?$.fn.transition!==n?P.transition(i.transition,i.duration):P.fadeIn(i.duration):P.show()}},is:{onScreen:function(){var e=O.get.elementCalculations();return e.onScreen},offScreen:function(){var e=O.get.elementCalculations();return e.offScreen},visible:function(){return O.cache&&O.cache.element?!(0===O.cache.element.width&&0===O.cache.element.offset.top):!1}},refresh:function(){O.debug("Refreshing constants (width/height)"),"fixed"==i.type&&(O.remove.fixed(),O.remove.occurred()),O.reset(),O.save.position(),i.checkOnRefresh&&O.checkVisibility(),i.onRefresh.call(S)},reset:function(){O.verbose("Reseting all cached values"),$.isPlainObject(O.cache)&&(O.cache.screen={},O.cache.element={})},checkVisibility:function(e){O.verbose("Checking visibility of element",O.cache.element),!k&&O.is.visible()&&(O.save.scroll(e),O.save.calculations(),O.passed(),O.passingReverse(),O.topVisibleReverse(),O.bottomVisibleReverse(),O.topPassedReverse(),O.bottomPassedReverse(),O.onScreen(),O.offScreen(),O.passing(),O.topVisible(),O.bottomVisible(),O.topPassed(),O.bottomPassed(),i.onUpdate&&i.onUpdate.call(S,O.get.elementCalculations()))},passed:function(e,o){var t=O.get.elementCalculations(),s;if(e&&o)i.onPassed[e]=o;else{if(e!==n)return O.get.pixelsPassed(e)>t.pixelsPassed;t.passing&&$.each(i.onPassed,function(e,o){t.bottomVisible||t.pixelsPassed>O.get.pixelsPassed(e)?O.execute(o,e):i.once||O.remove.occurred(o)})}},onScreen:function(e){var o=O.get.elementCalculations(),t=e||i.onOnScreen,s="onScreen";return e&&(O.debug("Adding callback for onScreen",e),i.onOnScreen=e),o.onScreen?O.execute(t,s):i.once||O.remove.occurred(s),e!==n?o.onOnScreen:void 0},offScreen:function(e){var o=O.get.elementCalculations(),t=e||i.onOffScreen,s="offScreen";return e&&(O.debug("Adding callback for offScreen",e),i.onOffScreen=e),o.offScreen?O.execute(t,s):i.once||O.remove.occurred(s),e!==n?o.onOffScreen:void 0},passing:function(e){var o=O.get.elementCalculations(),t=e||i.onPassing,s="passing";return e&&(O.debug("Adding callback for passing",e),i.onPassing=e),o.passing?O.execute(t,s):i.once||O.remove.occurred(s),e!==n?o.passing:void 0},topVisible:function(e){var o=O.get.elementCalculations(),t=e||i.onTopVisible,s="topVisible";return e&&(O.debug("Adding callback for top visible",e),i.onTopVisible=e),o.topVisible?O.execute(t,s):i.once||O.remove.occurred(s),e===n?o.topVisible:void 0},bottomVisible:function(e){var o=O.get.elementCalculations(),t=e||i.onBottomVisible,s="bottomVisible";return e&&(O.debug("Adding callback for bottom visible",e),i.onBottomVisible=e),o.bottomVisible?O.execute(t,s):i.once||O.remove.occurred(s),e===n?o.bottomVisible:void 0},topPassed:function(e){var o=O.get.elementCalculations(),t=e||i.onTopPassed,s="topPassed";return e&&(O.debug("Adding callback for top passed",e),i.onTopPassed=e),o.topPassed?O.execute(t,s):i.once||O.remove.occurred(s),e===n?o.topPassed:void 0},bottomPassed:function(e){var o=O.get.elementCalculations(),t=e||i.onBottomPassed,s="bottomPassed";return e&&(O.debug("Adding callback for bottom passed",e),i.onBottomPassed=e),o.bottomPassed?O.execute(t,s):i.once||O.remove.occurred(s),e===n?o.bottomPassed:void 0},passingReverse:function(e){var o=O.get.elementCalculations(),t=e||i.onPassingReverse,s="passingReverse";return e&&(O.debug("Adding callback for passing reverse",e),i.onPassingReverse=e),o.passing?i.once||O.remove.occurred(s):O.get.occurred("passing")&&O.execute(t,s),e!==n?!o.passing:void 0},topVisibleReverse:function(e){var o=O.get.elementCalculations(),t=e||i.onTopVisibleReverse,s="topVisibleReverse";return e&&(O.debug("Adding callback for top visible reverse",e),i.onTopVisibleReverse=e),o.topVisible?i.once||O.remove.occurred(s):O.get.occurred("topVisible")&&O.execute(t,s),e===n?!o.topVisible:void 0},bottomVisibleReverse:function(e){var o=O.get.elementCalculations(),t=e||i.onBottomVisibleReverse,s="bottomVisibleReverse";return e&&(O.debug("Adding callback for bottom visible reverse",e),i.onBottomVisibleReverse=e),o.bottomVisible?i.once||O.remove.occurred(s):O.get.occurred("bottomVisible")&&O.execute(t,s),e===n?!o.bottomVisible:void 0},topPassedReverse:function(e){var o=O.get.elementCalculations(),t=e||i.onTopPassedReverse,s="topPassedReverse";return e&&(O.debug("Adding callback for top passed reverse",e),i.onTopPassedReverse=e),o.topPassed?i.once||O.remove.occurred(s):O.get.occurred("topPassed")&&O.execute(t,s),e===n?!o.onTopPassed:void 0},bottomPassedReverse:function(e){var o=O.get.elementCalculations(),t=e||i.onBottomPassedReverse,s="bottomPassedReverse";return e&&(O.debug("Adding callback for bottom passed reverse",e),i.onBottomPassedReverse=e),o.bottomPassed?i.once||O.remove.occurred(s):O.get.occurred("bottomPassed")&&O.execute(t,s),e===n?!o.bottomPassed:void 0},execute:function(e,o){var n=O.get.elementCalculations(),t=O.get.screenCalculations();e=e||!1,e&&(i.continuous?(O.debug("Callback being called continuously",o,n),e.call(S,n,t)):O.get.occurred(o)||(O.debug("Conditions met",o,n),e.call(S,n,t))),O.save.occurred(o)},remove:{fixed:function(){O.debug("Removing fixed position"),P.removeClass(f.fixed).css({position:"",top:"",left:"",zIndex:""})},occurred:function(e){if(e){var o=O.cache.occurred;o[e]!==n&&o[e]===!0&&(O.debug("Callback can now be called again",e),O.cache.occurred[e]=!1)}else O.cache.occurred={}}},save:{calculations:function(){O.verbose("Saving all calculations necessary to determine positioning"),O.save.direction(),O.save.screenCalculations(),O.save.elementCalculations()},occurred:function(e){e&&(O.cache.occurred[e]!==n&&O.cache.occurred[e]===!0||(O.verbose("Saving callback occurred",e),O.cache.occurred[e]=!0))},scroll:function(e){e=e+i.offset||x.scrollTop()+i.offset,O.cache.scroll=e},direction:function(){var e=O.get.scroll(),o=O.get.lastScroll(),n;return n=e>o&&o?"down":o>e&&o?"up":"static",O.cache.direction=n,O.cache.direction},elementPosition:function(){var e=O.cache.element,o=O.get.screenSize();return O.verbose("Saving element position"),e.fits=e.height<o.height,e.offset=P.offset(),e.width=P.outerWidth(),e.height=P.outerHeight(),O.cache.element=e,e},elementCalculations:function(){var e=O.get.screenCalculations(),o=O.get.elementPosition();return i.includeMargin?(o.margin={},o.margin.top=parseInt(P.css("margin-top"),10),o.margin.bottom=parseInt(P.css("margin-bottom"),10),o.top=o.offset.top-o.margin.top,o.bottom=o.offset.top+o.height+o.margin.bottom):(o.top=o.offset.top,o.bottom=o.offset.top+o.height),o.topVisible=e.bottom>=o.top,o.topPassed=e.top>=o.top,o.bottomVisible=e.bottom>=o.bottom,o.bottomPassed=e.top>=o.bottom,o.pixelsPassed=0,o.percentagePassed=0,o.onScreen=o.topVisible&&!o.bottomPassed,o.passing=o.topPassed&&!o.bottomPassed,o.offScreen=!o.onScreen,o.passing&&(o.pixelsPassed=e.top-o.top,o.percentagePassed=(e.top-o.top)/o.height),O.cache.element=o,O.verbose("Updated element calculations",o),o},screenCalculations:function(){var e=O.get.scroll();return O.save.direction(),O.cache.screen.top=e,O.cache.screen.bottom=e+O.cache.screen.height,O.cache.screen},screenSize:function(){O.verbose("Saving window position"),O.cache.screen={height:x.height()}},position:function(){O.save.screenSize(),O.save.elementPosition()}},get:{pixelsPassed:function(e){var o=O.get.elementCalculations();return e.search("%")>-1?o.height*(parseInt(e,10)/100):parseInt(e,10)},occurred:function(e){return O.cache.occurred!==n?O.cache.occurred[e]||!1:!1},direction:function(){return O.cache.direction===n&&O.save.direction(),O.cache.direction},elementPosition:function(){return O.cache.element===n&&O.save.elementPosition(),O.cache.element},elementCalculations:function(){return O.cache.element===n&&O.save.elementCalculations(),O.cache.element},screenCalculations:function(){return O.cache.screen===n&&O.save.screenCalculations(),O.cache.screen},screenSize:function(){return O.cache.screen===n&&O.save.screenSize(),O.cache.screen},scroll:function(){return O.cache.scroll===n&&O.save.scroll(),O.cache.scroll},lastScroll:function(){return O.cache.screen===n?(O.debug("First scroll event, no last scroll could be found"),!1):O.cache.screen.top}},setting:function(e,o){if($.isPlainObject(e))$.extend(!0,i,e);else{if(o===n)return i[e];i[e]=o}},internal:function(e,o){if($.isPlainObject(e))$.extend(!0,O,e);else{if(o===n)return O[e];O[e]=o}},debug:function(){i.debug&&(i.performance?O.performance.log(arguments):(O.debug=Function.prototype.bind.call(console.info,console,i.name+":"),O.debug.apply(console,arguments)))},verbose:function(){i.verbose&&i.debug&&(i.performance?O.performance.log(arguments):(O.verbose=Function.prototype.bind.call(console.info,console,i.name+":"),O.verbose.apply(console,arguments)))},error:function(){O.error=Function.prototype.bind.call(console.error,console,i.name+":"),O.error.apply(console,arguments)},performance:{log:function(e){var o,n,t;i.performance&&(o=(new Date).getTime(),t=c||o,n=o-t,c=o,r.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:S,"Execution Time":n})),clearTimeout(O.performance.timer),O.performance.timer=setTimeout(O.performance.display,500)},display:function(){var e=i.name+":",o=0;c=!1,clearTimeout(O.performance.timer),$.each(r,function(e,n){o+=n["Execution Time"]}),e+=" "+o+"ms",s&&(e+=" '"+s+"'"),(console.group!==n||console.table!==n)&&r.length>0&&(console.groupCollapsed(e),console.table?console.table(r):$.each(r,function(e,o){console.log(o.Name+": "+o["Execution Time"]+"ms")}),console.groupEnd()),r=[]}},invoke:function(e,o,t){var i=R,s,c,r;return o=o||d,t=S||t,"string"==typeof e&&i!==n&&(e=e.split(/[\. ]/),s=e.length-1,$.each(e,function(o,t){var r=o!=s?t+e[o+1].charAt(0).toUpperCase()+e[o+1].slice(1):e;if($.isPlainObject(i[r])&&o!=s)i=i[r];else{if(i[r]!==n)return c=i[r],!1;if(!$.isPlainObject(i[t])||o==s)return i[t]!==n?(c=i[t],!1):(O.error(m.method,e),!1);i=i[t]}})),$.isFunction(c)?r=c.apply(t,o):c!==n&&(r=c),$.isArray(u)?u.push(r):u!==n?u=[u,r]:r!==n&&(u=r),c}},l?(R===n&&O.initialize(),R.save.scroll(),R.save.calculations(),O.invoke(a)):(R!==n&&R.invoke("destroy"),O.initialize())}),u!==n?u:this},$.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:!1,verbose:!1,performance:!0,observeChanges:!0,initialCheck:!0,refreshOnLoad:!0,refreshOnResize:!0,checkOnRefresh:!0,once:!0,continuous:!1,offset:0,includeMargin:!1,context:e,throttle:!1,type:!1,transition:"fade in",duration:1e3,onPassed:{},onOnScreen:!1,onOffScreen:!1,onPassing:!1,onTopVisible:!1,onBottomVisible:!1,onTopPassed:!1,onBottomPassed:!1,onPassingReverse:!1,onTopVisibleReverse:!1,onBottomVisibleReverse:!1,onTopPassedReverse:!1,onBottomPassedReverse:!1,onUpdate:!1,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}}(jQuery,window,document);